!function(e){function t(t){for(var r,s,c=t[0],i=t[1],u=t[2],p=0,m=[];p<c.length;p++)s=c[p],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&m.push(n[s][0]),n[s]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);for(l&&l(t);m.length;)m.shift()();return a.push.apply(a,u||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],r=!0,c=1;c<o.length;c++){var i=o[c];0!==n[i]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=o[0]))}return e}var r={},n={0:0},a=[];function s(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=r,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(o,r,function(t){return e[t]}.bind(null,r));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var c=window.webpackJsonp=window.webpackJsonp||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=i;a.push([44,1]),o()}({10:function(e,t,o){e.exports={rooms:"rooms__2749b7a",heading:"heading__cc2b2eb",link:"link__99b7fa8",active:"active__bb769ef"}},43:function(e,t,o){},44:function(e,t,o){"use strict";o.r(t);var r,n,a,s,c,i=o(0),u=o.n(i),l=o(12),p=o.n(l),m=o(16),f=o(13),h=o(15),d=o.n(h),b=o(19),g=new b.ChatManager({instanceLocator:"v1:us1:166f12c1-f36e-4ed0-893f-553abe614333",userId:"marian",tokenProvider:new b.TokenProvider({url:"https://us1.pusherplatform.io/services/chatkit_token_provider/v1/166f12c1-f36e-4ed0-893f-553abe614333/token"}),connectionTimeout:5e3}),y=o(20),v=o.n(y),w=o(14),R=o.n(w),O=o(26),j=o.n(O),M=o(3),E=o.n(M),k=(o(37),o(1)),P=(r=function(){function e(t){d()(this,e),R()(this,"messages",n,this),R()(this,"joinableRooms",a,this),R()(this,"newMessageText",s,this),R()(this,"newRoom",c,this),this.currentRoomId="",this.rootStore=t,this.chatManager=this.rootStore.chatManager}return j()(e,[{key:"connectUser",value:function(){var e=this;this.chatManager.connect().then((function(t){e.currentUser=t,e.getRooms()})).catch((function(e){return console.error(e)}))}},{key:"getRooms",value:function(){var e=this;this.currentUser.getJoinableRooms().then((function(){e.joinableRooms=e.currentUser.rooms})).catch((function(e){return console.error("Error getting joinable rooms ",e)}))}},{key:"subscribeToRoom",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentRoomId;this.clearMessages(),this.currentRoomId=t,this.currentUser.subscribeToRoomMultipart({roomId:t,hooks:{onMessage:function(t){e.pushMessage(t)}},messageLimit:20}).catch((function(e){return console.error(e)}))}},{key:"clearMessages",value:function(){this.messages=[]}},{key:"pushMessage",value:function(e){this.messages=[].concat(v()(this.messages),[e])}},{key:"handleNewRoom",value:function(e){this.newRoom=e}},{key:"createRoom",value:function(){var e=this,t="#".concat(this.newRoom);this.currentRoomId=t,this.currentUser.createRoom({name:this.newRoom,id:t,private:!1}).then((function(t){return e.currentUser.joinRoom({roomId:t.id}),t})).then((function(t){return e.subscribeToRoom(t.id),t})).then((function(t){return e.pushRoom(t)})).catch((function(e){return console.error(e)}))}},{key:"pushRoom",value:function(e){this.joinableRooms=[].concat(v()(this.joinableRooms),[e])}},{key:"handleInput",value:function(e){this.newMessageText=e}},{key:"sendMessage",value:function(){this.currentUser.sendMessage({roomId:this.currentRoomId,text:this.newMessageText})}}]),e}(),n=E()(r.prototype,"messages",[k.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a=E()(r.prototype,"joinableRooms",[k.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),s=E()(r.prototype,"newMessageText",[k.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),c=E()(r.prototype,"newRoom",[k.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),E()(r.prototype,"connectUser",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"connectUser"),r.prototype),E()(r.prototype,"getRooms",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"getRooms"),r.prototype),E()(r.prototype,"subscribeToRoom",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"subscribeToRoom"),r.prototype),E()(r.prototype,"clearMessages",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"clearMessages"),r.prototype),E()(r.prototype,"pushMessage",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"pushMessage"),r.prototype),E()(r.prototype,"handleNewRoom",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"handleNewRoom"),r.prototype),E()(r.prototype,"createRoom",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"createRoom"),r.prototype),E()(r.prototype,"pushRoom",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"pushRoom"),r.prototype),E()(r.prototype,"handleInput",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"handleInput"),r.prototype),E()(r.prototype,"sendMessage",[k.d],Object.getOwnPropertyDescriptor(r.prototype,"sendMessage"),r.prototype),r),x=new function e(){d()(this,e),this.chatManager=g,this.main=new P(this)};function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"store";return Object(f.b)(t)(Object(f.c)(e))}var T=o(27),_=o.n(T),I=o(8),D=o(10),U=o.n(D),S=N(Object(I.d)((function(e){var t=e.rooms,o=_()(e,["rooms"]);return u.a.createElement("div",{className:U.a.rooms},u.a.createElement("ul",null,u.a.createElement("h3",{className:U.a.heading},"Your rooms:"),t?t.map((function(e){return u.a.createElement("li",{key:e.id,className:U.a.room},u.a.createElement(m.b,{activeClassName:U.a.active,onClick:function(){return o.store.main.subscribeToRoom(e.id)},to:e.name,className:U.a.link},"# ",e.name))})):null))}))),C=function(e){var t=e.username,o=e.text;return u.a.createElement("div",{className:"message"},u.a.createElement("div",{className:"message-username"},t),u.a.createElement("div",{className:"message-text"},o))},z=function(e){var t=e.messages;return Object(i.useEffect)((function(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}),[t]),u.a.createElement("div",{className:"message-list"},t.map((function(e,t){return u.a.createElement(C,{key:t,username:e.senderId,text:e.parts[0].payload.content})})))},J=N((function(e){var t=e.store.main,o=Object(i.useRef)(null);return u.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t.sendMessage(),o.current.value="",o.current.focus()},className:"send-message-form"},u.a.createElement("input",{ref:o,value:t.newMessageText,onChange:function(e){t.handleInput(e.target.value)},placeholder:"Write a message...",type:"text"}))})),L=N((function(e){var t=e.store.main,o=Object(i.useRef)(null);return u.a.createElement("div",{className:"new-room-form"},u.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t.createRoom(),o.current.value=""}},u.a.createElement("input",{ref:o,value:t.newRoom,onChange:function(e){t.handleNewRoom(e.target.value)},placeholder:"Create room...",type:"text"}),u.a.createElement("button",{id:"create-room-btn",type:"submit"},"+")))})),q=N((function(e){var t=e.store.main,o=t.messages,r=t.joinableRooms;return Object(i.useEffect)((function(){window.location.replace("#/"),t.connectUser()}),[]),Object(i.useMemo)((function(){return u.a.createElement("div",{className:"app"},u.a.createElement(S,{rooms:r}),u.a.createElement(z,{messages:o}),u.a.createElement(J,null),u.a.createElement(L,null))}),[r,o])})),H=(o(43),u.a.createElement(f.a,{store:x},u.a.createElement(m.a,null,u.a.createElement(q,null))));p.a.render(H,document.querySelector("#root"))}});